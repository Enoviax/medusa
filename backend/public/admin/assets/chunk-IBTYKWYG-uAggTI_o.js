import{r as T}from"./chunk-K7S5TX6I-Cn7mcHiU.js";import{f as x}from"./chunk-OV5NMSY6-CzJZ0JaW.js";import{a as P}from"./chunk-XFSJ7YIN-CYgS8ok5.js";import{a as f,g as h}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{u as C}from"./chunk-OPNCOFGA-L5fGmztF.js";import{aM as B,j as e,C as M,b as o,H as R,T as n,_ as S,Y as g,A as D,B as A,t as p,r as H,m as k}from"./index-HrqC_Gjd.js";import{D as O}from"./document-text-tYu_pso2.js";import{A as y}from"./arrow-down-right-mini-GwR2Vb34.js";import{X as E}from"./x-circle-BsI_aa6f.js";import{T as I}from"./Trans-EQ5E-fso.js";import{u as W}from"./use-prompt-B2nwlCmB.js";import{S as _}from"./status-badge-DAzHDOtt.js";import{f as v}from"./format-G2WeL2O3.js";var X=a=>a.reduce((s,t)=>(s=s+(t.captured_amount-t.refunded_amount),s),0),$=a=>a.reduce((s,t)=>(s+=t.amount-t.captured_amount,s),0),q=B(T());function F({id:a,className:s}){const{t}=o(),[r,i]=H.useState(!1),d=()=>{(0,q.default)(a),p.success(t("actions.idCopiedToClipboard"))};return e.jsx(g,{maxWidth:260,content:a,open:r,onOpenChange:i,children:e.jsxs("span",{onClick:d,className:k("cursor-pointer",s),children:["#",a.slice(-7)]})})}var j=F,K=a=>a.payment_collections.map(s=>s.payments).flat(1).filter(Boolean),de=({order:a})=>{const s=K(a),t=s.map(r=>r==null?void 0:r.refunds).flat(1).filter(Boolean);return e.jsxs(M,{className:"divide-y divide-dashed p-0",children:[e.jsx(L,{order:a}),e.jsx(G,{order:a,payments:s,refunds:t,currencyCode:a.currency_code}),e.jsx(J,{paymentCollections:a.payment_collections,currencyCode:a.currency_code})]})},L=({order:a})=>{const{t:s}=o(),{label:t,color:r}=P(s,a.payment_status);return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(R,{level:"h2",children:s("orders.payment.title")}),e.jsx(_,{color:r,className:"text-nowrap",children:t})]})},N=({refund:a,currencyCode:s})=>{const{t}=o(),r=(a==null?void 0:a.refund_reason)&&e.jsx(S,{size:"2xsmall",className:"cursor-default select-none capitalize",rounded:"full",children:a.refund_reason.label}),i=a.note&&e.jsx(g,{content:a.note,children:e.jsx(O,{className:"text-ui-tag-neutral-icon ml-1 inline"})});return e.jsxs("div",{className:"bg-ui-bg-subtle text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"self-center pr-3",children:e.jsx(y,{className:"text-ui-fg-muted"})}),e.jsxs("div",{children:[e.jsxs(n,{size:"small",leading:"compact",weight:"plus",children:[t("orders.payment.refund")," ",i]}),e.jsx(n,{size:"small",leading:"compact",children:v(new Date(a.created_at),"dd MMM, yyyy, HH:mm:ss")})]})]}),e.jsx("div",{className:"flex items-center justify-end",children:r}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(n,{size:"small",leading:"compact",children:["- ",h(a.amount,s)]})})]})},Y=({order:a,payment:s,refunds:t,currencyCode:r})=>{const{t:i}=o(),d=W(),{mutateAsync:c}=C(a.id,s.id),l=async()=>{await d({title:i("orders.payment.capture"),description:i("orders.payment.capturePayment",{amount:x(s.amount,r)}),confirmText:i("actions.confirm"),cancelText:i("actions.cancel"),variant:"confirmation"})&&await c({amount:s.amount},{onSuccess:()=>{p.success(i("orders.payment.capturePaymentSuccess",{amount:x(s.amount,r)}))},onError:z=>{p.error(z.message)}})},[m,w]=s.captured_at?["Captured","green"]:["Pending","orange"],b=s.captured_at===null&&s.canceled_at===null;return e.jsxs("div",{className:"divide-y divide-dashed",children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4 sm:grid-cols-[1fr_1fr_1fr_1fr_20px]",children:[e.jsxs("div",{className:"w-full min-w-[60px] overflow-hidden",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",className:"truncate",children:e.jsx(j,{id:s.id})}),e.jsx(n,{size:"small",leading:"compact",children:v(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss")})]}),e.jsx("div",{className:"hidden items-center justify-end sm:flex",children:e.jsx(n,{size:"small",leading:"compact",className:"capitalize",children:s.provider_id})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(_,{color:w,className:"text-nowrap",children:m})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{size:"small",leading:"compact",children:h(s.amount,s.currency_code)})}),e.jsx(D,{groups:[{actions:[{label:i("orders.payment.refund"),icon:e.jsx(E,{}),to:`/orders/${a.id}/refund?paymentId=${s.id}`,disabled:!s.captured_at}]}]})]}),b&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(y,{className:"text-ui-fg-muted shrink-0"}),e.jsx(n,{size:"small",leading:"compact",children:e.jsx(I,{i18nKey:"orders.payment.isReadyToBeCaptured",components:[e.jsx(j,{id:s.id})]})})]}),e.jsxs(A,{className:"shrink-0",size:"small",variant:"secondary",onClick:l,children:[e.jsx("span",{className:"hidden sm:block",children:i("orders.payment.capture")}),e.jsx("span",{className:"sm:hidden",children:i("orders.payment.capture_short")})]})]}),t.map(u=>e.jsx(N,{refund:u,currencyCode:r},u.id))]})},G=({order:a,payments:s,refunds:t,currencyCode:r})=>{const d=[...t.filter(c=>c.payment_id===null),...s].sort((c,l)=>new Date(c.created_at).getTime()-new Date(l.created_at).getTime()).map(c=>({event:c,type:c.id.startsWith("pay_")?"payment":"refund"}));return e.jsx("div",{className:"flex flex-col divide-y divide-dashed",children:d.map(({type:c,event:l})=>{switch(c){case"payment":return e.jsx(Y,{order:a,payment:l,refunds:t.filter(m=>m.payment_id===l.id),currencyCode:r},l.id);case"refund":return e.jsx(N,{refund:l,currencyCode:r},l.id)}})})},J=({paymentCollections:a,currencyCode:s})=>{const{t}=o(),r=$(a);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:t("orders.payment.totalPaidByCustomer")}),e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:f(X(a),s)})]}),r>0&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:"Total pending"}),e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:f(r,s)})]})]})};export{de as O,K as a,X as g};
