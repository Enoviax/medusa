import{u as F,a as B,b as M}from"./chunk-QIWEFQ5Y-BcwhypO9.js";import{u as Q,a as H,b as $}from"./chunk-NLR7MGM2-BQyLO8To.js";import{S as K,d as U,dT as J,a as W,j as e,dE as X,q as P,b as S,u as Y,dU as Z,C as w,H as T,A as R,T as u,r as k,dL as V,k as G,dV as ee,bx as i,L as se,B as te,aL as re,p as ae,s as oe,t as f,dW as ie}from"./index-HrqC_Gjd.js";import{S as ne}from"./chunk-UR2E444G-Dxg_E1qB.js";import"./chunk-3IW4HYUP-B0hjLMKq.js";import{u as N,D as z}from"./chunk-OMP35ZTD-BzF4W0Sz.js";import"./lodash-DnQioFv5.js";import"./chunk-2XYHZG6S-TOWhaigI.js";import"./chunk-E3YGDIJC-Cs2OmRxi.js";import{P as I}from"./pencil-square-m42K-ws3.js";import{T as L}from"./trash-Cj0dULeA.js";import{u as _}from"./use-prompt-B2nwlCmB.js";import{S as ce}from"./status-badge-DAzHDOtt.js";import{C as A}from"./checkbox-DsQ4hJO_.js";import{c as le}from"./index-DZRnaetd.js";import"./chunk-C76H5USB-CPsw4htd.js";import"./chunk-OI7BBNYW-CqFrQu54.js";import"./chunk-P3UUX2T6-CoxaAzXV.js";import"./chunk-B4FQDBC3-DH6aAkFN.js";import"./format-G2WeL2O3.js";import"./chunk-LHJ6JQGA-DDoE7lkI.js";import"./chunk-FSMQADBD-DQ6u7KYm.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-XFSJ7YIN-CYgS8ok5.js";import"./chunk-ADOCJB6L-oyws-Ex1.js";import"./react-country-flag.esm-CaD3AKTA.js";import"./Trans-EQ5E-fso.js";import"./x-mark-mini-Q_ZRZRmQ.js";import"./chunk-YEDAFXMB-B43R7CK6.js";import"./chunk-AOFGTNG6-Dh0uMGDi.js";import"./chunk-WX2SMNCD-CTOHXE5S.js";import"./plus-mini-JAMyv6UA.js";import"./command-bar-CQ2ojk6i.js";import"./index-Bm0_N0_B.js";import"./chunk-QAF7PVQE-Dz18IPLi.js";import"./date-picker-B0rw1wqZ.js";import"./popover-sllarloD.js";import"./triangle-left-mini-BifPdMwa.js";import"./prompt-DzgdWoNF.js";var de=({customer:s})=>{const{t}=S(),r=_(),a=Y(),{mutateAsync:l}=Z(s.id),c=[s.first_name,s.last_name].filter(Boolean).join(" "),o=s.has_account?"green":"orange",d=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),p=async()=>{await r({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await l(void 0,{onSuccess:()=>{f.success(t("customers.delete.successToast",{email:s.email})),a("/customers",{replace:!0})},onError:x=>{f.error(x.message)}})};return e.jsxs(w,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(ce,{color:o,children:d}),e.jsx(R,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(I,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(L,{}),onClick:p}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(u,{size:"small",leading:"compact",children:c||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(u,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(u,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},v=10,j="cusgr",me=({customer:s})=>{const t=_(),[r,a]=k.useState({}),{raw:l,searchParams:c}=F({pageSize:v,prefix:j}),{customer_groups:o,count:d,isLoading:p,isError:g,error:x}=V({...c,fields:"+customers.id",customers:{id:s.id}},{placeholderData:G}),{mutateAsync:h}=ee(s.id),y=B(),E=pe(s.id),{table:O}=N({data:o??[],columns:E,count:d,getRowId:m=>m.id,enablePagination:!0,enableRowSelection:!0,pageSize:v,prefix:j,rowSelection:{state:r,updater:a}}),q=async()=>{const m=Object.keys(r);if(await t({title:i("general.areYouSure"),description:i("customers.groups.removeMany",{groups:o==null?void 0:o.filter(n=>m.includes(n.id)).map(n=>n.name).join(",")}),confirmText:i("actions.remove"),cancelText:i("actions.cancel")}))try{await h({remove:m}),f.success(i("customers.groups.removed.success",{groups:o.filter(n=>m.includes(n.id)).map(n=>n==null?void 0:n.name)}))}catch(n){f.error(n.message)}};if(g)throw x;return e.jsxs(w,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{level:"h2",children:i("customerGroups.domain")}),e.jsx(se,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(te,{variant:"secondary",size:"small",children:i("general.add")})})]}),e.jsx(z,{table:O,columns:E,pageSize:v,isLoading:p,count:d,prefix:j,navigateTo:m=>`/customer-groups/${m.id}`,filters:y,search:!0,pagination:!0,orderBy:[{key:"name",label:i("fields.name")},{key:"created_at",label:i("fields.createdAt")},{key:"updated_at",label:i("fields.updatedAt")}],commands:[{action:q,label:i("actions.remove"),shortcut:"r"}],queryObject:l,noRecords:{message:i("customers.groups.list.noRecordsMessage")}})]})},ue=({group:s,customerId:t})=>{const r=_(),{t:a}=S(),{mutateAsync:l}=ie(s.id),c=async()=>{await r({title:a("general.areYouSure"),description:a("customers.groups.remove",{name:s.name}),confirmText:a("actions.remove"),cancelText:a("actions.cancel")})&&await l([t],{onError:d=>{f.error(d.message)}})};return e.jsx(R,{groups:[{actions:[{label:a("actions.edit"),icon:e.jsx(I,{}),to:`/customer-groups/${s.id}/edit`},{label:a("actions.remove"),onClick:c,icon:e.jsx(L,{})}]}]})},D=le(),pe=s=>{const t=M();return k.useMemo(()=>[D.display({id:"select",header:({table:r})=>e.jsx(A,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:a=>r.toggleAllPageRowsSelected(!!a)}),cell:({row:r})=>e.jsx(A,{checked:r.getIsSelected(),onCheckedChange:a=>r.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),...t,D.display({id:"actions",cell:({row:r})=>e.jsx(ue,{group:r.original,customerId:s})})],[t])},b="cusord",C=10,ge="*customer,*items,*sales_channel",xe="id,status,display_id,created_at,email,fulfillment_status,payment_status,total,currency_code",fe=({customer:s})=>{const{t}=S(),{searchParams:r,raw:a}=Q({pageSize:C,prefix:b}),{orders:l,count:c,isLoading:o,isError:d,error:p}=re({customer_id:s.id,fields:xe+","+ge,...r},{placeholderData:G}),g=he(),x=H(),{table:h}=N({data:l??[],columns:g,enablePagination:!0,count:c,pageSize:C,prefix:b});if(d)throw p;return e.jsxs(w,{className:"divide-y p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(T,{level:"h2",children:t("orders.domain")})}),e.jsx(z,{columns:g,table:h,pagination:!0,navigateTo:y=>`/orders/${y.original.id}`,filters:x,count:c,isLoading:o,pageSize:C,orderBy:[{key:"display_id",label:t("orders.fields.displayId")},{key:"created_at",label:t("fields.createdAt")},{key:"updated_at",label:t("fields.updatedAt")}],search:!0,queryObject:a,prefix:b})]})},he=()=>{const s=$({exclude:["customer"]});return k.useMemo(()=>[...s],[s])},os=()=>{const{id:s}=K(),t=U(),{customer:r,isLoading:a,isError:l,error:c}=J(s,void 0,{initialData:t}),{getWidgets:o}=W();if(a||!r)return e.jsx(X,{sections:2,showJSON:!0,showMetadata:!0});if(l)throw c;return e.jsxs(ne,{widgets:{before:o("customer.details.before"),after:o("customer.details.after")},data:r,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(de,{customer:r}),e.jsx(fe,{customer:r}),e.jsx(me,{customer:r})]})},ye=s=>({queryKey:ae.detail(s),queryFn:async()=>oe.admin.customer.retrieve(s)}),is=async({params:s})=>{const t=s.id,r=ye(t);return P.getQueryData(r.queryKey)??await P.fetchQuery(r)};export{os as Component,is as loader};
